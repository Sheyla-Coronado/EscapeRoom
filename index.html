<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Escape‚Ä¶ if you can!</title>
  <style>

    .digit {
      padding: 15px;
      font-size: 1.2rem;
      border-radius: 5px;
      cursor: pointer;
      border: 1px solid #555;
    }
    .digit-found {
      background: var(--accent);
      color: black;
      font-weight: bold;
    }
    .digit-disabled {
      background: #333;
      color: #666;
      cursor: not-allowed;
      opacity: 0.5;
    }

    
    /* ========== VARIABLES ========== */
    :root {
      --bg: #1e1e2f;
      --panel: #2a2a40;
      --accent: #c9a227;
      --text: #f5f5f5;
    }

    /* ========== BASE STYLES ========== */
    * {
      box-sizing: border-box;
      font-family: system-ui, sans-serif;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
    }

    .app {
      max-width: 1100px;
      margin: auto;
      padding: 16px;
    }

    h1, h2, h3 {
      margin-bottom: 12px;
    }

    /* ========== SCREEN NAVIGATION ========== */
    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    /* ========== BUTTONS ========== */
    button {
      width: 100%;
      padding: 14px;
      margin: 8px 0;
      border: none;
      border-radius: 8px;
      background: var(--accent);
      color: #000;
      font-size: 1rem;
      cursor: pointer;
      font-weight: 600;
    }

    button.secondary {
      background: #444;
      color: #fff;
    }

    /* ========== FORM INPUTS ========== */
    select, input {
      padding: 6px;
      border-radius: 6px;
      border: none;
    }

    /* ========== CARD GRID ========== */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 12px;
    }

    .card {
      background: var(--panel);
      border-radius: 10px;
      padding: 12px;
    }

    /* ========== ROOMS SCREEN ========== */
    .rooms-topbar {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .rooms-header {
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .rooms-search {
      position: relative;
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
      flex-wrap: nowrap;
    }

    .back-btn {
      width: 28px;
      height: 28px;
      padding: 0;
      border-radius: 6px;
      font-size: 16px;
      background: #444;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      margin-right: 8px;
      margin-top: 0;
      margin-bottom: 0;
    }

    .search-input {
      flex: 1;
      max-width: 260px;
      min-width: 0;
      padding: 8px 10px;
      border-radius: 6px;
      border: none;
    }

    .filter-anchor {
      position: relative;
      display: inline-block;
    }

    .filter-btn {
      width: 32px;
      height: 32px;
      border-radius: 6px;
      font-size: 20px;
      background: #444;
      color: #fff;
      padding: 0;
      margin: 0;
    }

    .filter-menu {
      position: absolute;
      top: 50%;
      left: calc(100% + 8px);
      transform: translateY(-50%);
      background: var(--panel);
      padding: 10px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 999;
      min-width: 160px;
    }

    /* ========== GAME SCREEN ========== */
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 8px;
    }

    .game {
      background: var(--panel);
      border-radius: 12px;
      padding: 12px;
    }

    .game-view {
      position: relative;
      width: 100%;
      aspect-ratio: 3 / 2;
      max-height: 66vh;
      border-radius: 10px;
      margin-bottom: 8px;
      background-color: #111;
      display: block;
      padding: 0;
      overflow: hidden;
    }

    .game-view img#sceneImage,
    .game-view svg#sceneImage {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      object-position: center 30%;
      border-radius: 8px;
      z-index: 1;
    }

    /* ========== HOTSPOTS ========== */
    .hotspot {
      position: absolute;
      background: transparent !important;
      border: none !important;
      cursor: pointer;
      z-index: 50;
      pointer-events: auto;
      transition: none;
    }

    /* remove any accidental outlines */
    .hotspot.show-outline,
    .hotspot.editing {
      border: none !important;
      background: transparent !important;
    }

    /* Mystery Mansion Hotspots */
    .room-mystery .hotspot.painting {
      left: 44.1667%;
      top: 6%;
      width: 13%;
      height: 25%;
    }

    .room-mystery .hotspot.fireplace {
      left: 40%;
      top: 33.75%;
      width: 20%;
      height: 27.5%;
    }

    .room-mystery .hotspot.door {
      left: 73%;
      top: 25%;
      width: 10%;
      height: 35%;
      z-index: 60;
    }

    .room-mystery .hotspot.safe {
      left: 73%;
      top: 70%;
      width: 5%;
      height: 10%;
      z-index: 60;
    }

    .room-mystery .hotspot.rug {
      left: 36.6667%;
      top: 70%;
      width: 26.6667%;
      height: 15%;
    }

    .room-mystery .hotspot.books {
      left: 20%;
      top: 53%;
      width: 6.6667%;
      height: 15%;
    }

/* Magical Library Hotspots */
.room-library .hotspot.crystal {
  left: 40%;
  top: 35%;
  width: 6%;
  height: 5%;
}

.room-library .hotspot.bookshelf {
  left: 8%;
  top: 5%;
  width: 5%;
  height: 5%;
}

.room-library .hotspot.candles {
  left: 48%;
  top: 28%;
  width: 8%;
  height: 13%;
}

.room-library .hotspot.scroll {
  left: 18%;
  top: 83%;
  width: 5%;
  height: 5%;
}

.room-library .hotspot.chest {
  left: 46%;
  top: 15%;
  width: 12%;
  height: 12%;
}

.room-library .hotspot.door {
  left: 63%;
  top: 8%;
  width: 18%;
  height: 45%;
  z-index: 60;
}

/* Pirate Cove Hotspots */
.room-pirate .hotspot.map {
  left: 4%;
  top: 48%;
  width: 8%;
  height: 10%;
}

.room-pirate .hotspot.barrel {
  left: 25%;
  top: 58%;
  width: 3%;
  height: 10%;
}

.room-pirate .hotspot.crates {
  left: 15%;
  top: 68%;
  width: 10%;
  height: 12%;
}

.room-pirate .hotspot.campfire {
  left: 45%;
  top: 55%;
  width: 5%;
  height: 8%;
}

.room-pirate .hotspot.sand {
  left: 70%;
  top: 60%;
  width: 5%;
  height: 5%;
}

.room-pirate .hotspot.door {
  left: 63%;
  top: 68%;
  width: 8%;
  height: 8%;
  z-index: 60;
}


    /* Haunted Asylum Hotspots */
    .room-asylum .hotspot.bed {
      position: absolute;
      left: 54%;
      top: 30%;
      width: 14%;
      height: 32%;
      transform: rotate(35deg);
    }

    .room-asylum .hotspot.tv {
      left: 35%;
      top: 59%;
      width: 12%;
      height: 18%;
    }

    .room-asylum .hotspot.paper {
      left: 36%;
      top: 53%;
      width: 5%;
      height: 4%;
    }

    .room-asylum .hotspot.firstaid {
      left: 28%;
      top: 5%;
      width: 8%;
      height: 30%;
    }

    .room-asylum .hotspot.pipe {
      left: 8%;
      top: 5%;
      width: 6%;
      height: 20%;
    }

    .room-asylum .hotspot.door {
      left: 83%;
      top: 8%;
      width: 15%;
      height: 50%;
      z-index: 60;
    }

    .hotspot.show-outline {
      border: 2px solid rgba(255, 0, 0, 0.6);
      background: rgba(255, 0, 0, 0.06);
    }

    .hotspot.editing {
      outline: 3px dashed rgba(255, 0, 0, 0.9);
    }

    /* ========== INVENTORY ========== */
    .inventory {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px;
      background: rgba(0, 0, 0, 0.14);
      border-radius: 8px;
      margin-top: 8px;
    }

    .inv-label {
      font-size: 0.85rem;
      color: #ddd;
      margin-right: 8px;
    }

    .inv-items {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .inv-item {
      width: 36px;
      height: 36px;
      border-radius: 6px;
      background: #fff;
      color: #111;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
    }

    .inv-item.selected {
      outline: 3px solid rgba(201, 162, 39, 0.9);
    }

    .clue-badge {
      width: 48px;
      height: 48px;
      border-radius: 8px;
      background: #fef6e3;
      color: #111;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: 700;
      border: 1px solid rgba(201, 162, 39, 0.25);
    }

    /* ========== DOOR KEYPAD ========== */
    #codeDisplay {
      font-family: monospace, monospace;
      text-align: center;
      padding: 8px 10px;
      background: #fff;
      color: #111;
      border-radius: 8px;
      display: inline-block;
      min-width: 124px;
      font-weight: 700;
      margin: 8px 0;
      letter-spacing: 14px;
      font-size: 26px;
    }

    #digitButtons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 320px;
      margin: 6px auto 12px;
    }

    #digitButtons .digit {
      width: 44px;
      min-width: 44px;
      height: 44px;
      border-radius: 8px;
      background: #fff;
      border: 1px solid #ddd;
      font-size: 16px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      box-sizing: border-box;
      margin: 0;
    }

    #digitButtons .digit.digit-found {
      background: #fff;
      color: #111;
      font-weight: 600;
      border: 1px solid #ddd;
    }

    #digitButtons .digit.digit-disabled {
      opacity: 0.28;
      cursor: not-allowed;
      transform: scale(0.95);
    }

    /* ========== MODALS & OVERLAYS ========== */
    .menu-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      pointer-events: auto;
    }

    .menu {
      background: var(--panel);
      border-radius: 12px;
      padding: 16px;
      width: 280px;
      pointer-events: auto;
    }

    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1500;
      pointer-events: auto;
    }

    .modal-content {
      background: var(--panel);
      padding: 16px;
      border-radius: 10px;
      max-width: 320px;
      position: relative;
      pointer-events: auto;
    }

    .modal-content button {
      width: auto;
      padding: 8px 12px;
    }

    /* ========== GAME PAUSE LOCK ========== */
    #game.paused .game-view,
    #game.paused .inventory {
      pointer-events: none;
      opacity: 0.7;
    }

    #game.paused .topbar {
      pointer-events: auto;
    }
    
    #game.paused .topbar button {
      pointer-events: auto;
    }

    /* ========== UTILITY CLASSES ========== */
    .hidden {
      display: none !important;
    }

    /* ========== RESPONSIVE ========== */
    @media (max-width: 480px) {
      .game-view {
        aspect-ratio: 3 / 2;
        max-height: 40vh;
      }
    }

    /* ========== RESPONSIVE UPGRADE ========== */

/* Base fluid scaling */
html {
  font-size: clamp(14px, 1.5vw, 16px);
}

/* App container adapts */
.app {
  padding: clamp(10px, 2vw, 16px);
}

/* Buttons scale better */
button {
  font-size: clamp(0.85rem, 1.5vw, 1rem);
}

/* Game view scales safely */
.game-view {
  width: 100%;
  max-height: 70vh;
}

/* Inventory adapts */
.inventory {
  flex-wrap: wrap;
}

.inv-item,
.clue-badge {
  width: clamp(32px, 8vw, 48px);
  height: clamp(32px, 8vw, 48px);
  font-size: clamp(14px, 3vw, 20px);
}

/* Room title + timer scale */
#roomTitle {
  font-size: clamp(0.9rem, 2.2vw, 1.1rem);
}

#timer {
  font-size: clamp(0.8rem, 2vw, 1rem);
}

/* ========================= */
/* üì± SMALL PHONES */
@media (max-width: 480px) {
  .topbar {
    gap: 6px;
  }

  .rooms-search {
    flex-wrap: wrap;
    justify-content: center;
  }

  .search-input {
    max-width: 100%;
  }

  .filter-menu {
    left: 0;
    top: calc(100% + 8px);
    transform: none;
  }

  .game-view {
    max-height: 42vh;
  }

  .inventory {
    gap: 6px;
  }
}

/* ========================= */
/* üì≤ TABLETS */
@media (min-width: 481px) and (max-width: 900px) {
  .game-view {
    max-height: 55vh;
  }

  .search-input {
    max-width: 320px;
  }
}

/* ========================= */
/* üñ• LARGE DESKTOPS */
@media (min-width: 1200px) {
  .app {
    max-width: 1200px;
  }

  .game-view {
    max-height: 75vh;
  }
}

  </style>
</head>
<body>
<div class="app">

  <!-- ========== MAIN MENU ========== -->
  <section id="main" class="screen active">
    <h1 id="mainTitle">üîë Escape‚Ä¶ if you can!</h1>
    <button onclick="resumeGame()" id="btnCurrentRoom">‚ñ∂ Current Room</button>
    <button onclick="showScreen('rooms')" id="btnBrowseRooms">üåê Browse Rooms</button>
    <button onclick="showScreen('settings')" id="btnSettings">‚öô Settings</button>
  </section>

  <!-- ========== ROOMS BROWSER ========== -->
  <section id="rooms" class="screen">
    <div class="topbar rooms-topbar">
      <div class="rooms-header">
        <h2 id="roomsTitle">Escape Rooms</h2>
      </div>

      <div class="rooms-search">
        <button class="back-btn" onclick="showScreen('main')">‚Üê</button>

        <input
          id="search"
          class="search-input"
          placeholder="Search rooms"
          oninput="renderRooms()"
        />

        <div class="filter-anchor">
          <button class="filter-btn" onclick="toggleFilterMenu()">‚ãØ</button>

          <div id="filterMenu" class="filter-menu hidden">
            <select id="difficulty" onchange="renderRooms()">
              <option value="" id="optDifficulty">Difficulty</option>
              <option id="optEasy">Easy</option>
              <option id="optMedium">Medium</option>
              <option id="optHard">Hard</option>
            </select>

            <select id="status" onchange="renderRooms()">
              <option value="" id="optStatus">Status</option>
              <option value="new" id="optNew">Not Played</option>
              <option value="progress" id="optProgress">In Progress</option>
              <option value="done" id="optDone">Completed</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <div id="roomGrid" class="grid" style="margin-top:12px"></div>
  </section>

  <!-- ========== GAME ========== -->
  <section id="game" class="screen">
    <div class="topbar">
      <button class="secondary" onclick="pauseGame()" style="width:44px;height:44px;padding:0;font-size:20px;margin:0;">‚ò∞</button>
      <strong id="roomTitle">Mystery Mansion ‚Äî Foyer</strong>
      <span id="timer">05:00</span>
    </div>

    <div class="game">
      <div class="game-view room-mystery" id="gameView">
        <img id="sceneImage" src="foyer.jpg" alt="Foyer" />

        <!-- Mystery Mansion Hotspots -->
        <div id="hotspotsMysterv" class="hotspots-container">
          <button class="hotspot books" title="Inspect books" onclick="interact('spot1')"></button>
          <button class="hotspot painting" title="Inspect painting" onclick="interact('spot2')"></button>
          <button class="hotspot fireplace" title="Inspect fireplace" onclick="interact('spot3')"></button>
          <button class="hotspot rug" title="Lift rug" onclick="interact('spot4')"></button>
          <button class="hotspot safe" title="Inspect safe" onclick="interact('spot5')"></button>
          <button class="hotspot door" title="Try door" onclick="tryDoor()"></button>
        </div>

        <!-- Magical Library Hotspots -->
        <div id="hotspotsLibrary" class="hotspots-container hidden">
          <button class="hotspot crystal" title="Inspect crystal ball" onclick="interact('spot1')"></button>
          <button class="hotspot bookshelf" title="Search bookshelf" onclick="interact('spot2')"></button>
          <button class="hotspot candles" title="Examine candles" onclick="interact('spot3')"></button>
          <button class="hotspot scroll" title="Read scroll" onclick="interact('spot4')"></button>
          <button class="hotspot chest" title="Open chest" onclick="interact('spot5')"></button>
          <button class="hotspot door" title="Push bookshelf" onclick="tryDoor()"></button>
        </div>

<!-- Pirate Cove Hotspots -->
<div id="hotspotsPirate" class="hotspots-container hidden">
  <button class="hotspot map" title="Search through papers" onclick="interact('spot1')"></button>
  <button class="hotspot barrel" title="Search barrel" onclick="interact('spot2')"></button>
  <button class="hotspot crates" title="Check crates" onclick="interact('spot3')"></button>
  <button class="hotspot campfire" title="Search around campfire" onclick="interact('spot4')"></button>
  <button class="hotspot sand" title="Check driftwood" onclick="interact('spot5')"></button>
  <button class="hotspot door" title="Dig for buried treasure" onclick="interact('spot6')"></button>
</div>

        <!-- Haunted Asylum Hotspots -->
        <div id="hotspotsAsylum" class="hotspots-container hidden">
          <button class="hotspot bed" title="Search bed" onclick="interact('spot1')"></button>
          <button class="hotspot tv" title="Examine TV" onclick="interact('spot2')"></button>
          <button class="hotspot paper" title="Read paper on TV" onclick="interact('spot3')"></button>
          <button class="hotspot firstaid" title="Open first-aid box" onclick="interact('spot4')"></button>
          <button class="hotspot pipe" title="Inspect pipe" onclick="interact('spot5')"></button>
          <button class="hotspot door" title="Try door" onclick="tryDoor()"></button>
        </div>
      </div>

      <div class="inventory" id="inventory">
        <div class="inv-label" id="invLabel">Inventory</div>
        <div class="inv-items" id="invItems"></div>
      </div>
    </div>
  </section>

  <!-- ========== VICTORY ========== -->
  <section id="victory" class="screen">
    <h1 id="victoryTitle">üéâ You Escaped!</h1>
    <p id="victoryText">You successfully completed the room!</p>
    <button onclick="showScreen('rooms')" id="btnBackToRooms">Back to Rooms</button>
    <button onclick="showScreen('main')" id="btnMainMenu">Main Menu</button>
  </section>

  <!-- ========== SETTINGS ========== -->
  <section id="settings" class="screen">
    <h2 id="settingsTitle">Settings</h2>
    <button onclick="toggleAudio()"><span id="btnAudioIcon">üîä</span> <span id="btnAudioText">Audio</span>: <span id="audioStatus">On</span></button>
    <button onclick="changeLanguage()">üåê <span id="btnLanguageText">Language</span>: <span id="langStatus">English</span></button>
    <button onclick="showControls()"><span id="btnControlsIcon">üéÆ</span> <span id="btnControlsText">Controls</span></button>
    <button onclick="showHowToPlay()"><span id="btnHelpIcon">‚ùì</span> <span id="btnHelpText">How to Play</span></button>
    <button onclick="showScreen('main')" id="btnClose">Close</button>
  </section>
</div>

<!-- ========== PAUSE MENU OVERLAY ========== -->
<div id="menuOverlay" class="menu-overlay">
  <div class="menu">
    <h3 id="pauseTitle">Paused</h3>
    <button onclick="resumeGame()" id="btnResume">Resume</button>
    <button onclick="showScreen('settings'); closeMenu()" id="btnPauseSettings">Settings</button>
    <button onclick="showScreen('main'); closeMenu()" id="btnQuit">Quit</button>
  </div>
</div>

<!-- ========== DOOR KEYPAD MODAL ========== -->
<div id="doorModal" class="modal hidden">
  <div class="modal-content">
    <h3 id="doorModalTitle">Door Keypad</h3>
    <p id="doorModalText">Enter the code by clicking the digits you have found</p>
    <div id="codeDisplay">_ _ _</div>
    <div id="digitButtons"></div>
    <div style="display:flex;gap:8px;justify-content:center">
      <button onclick="submitDoorCode()" id="btnSubmit">Submit</button>
      <button onclick="clearDoorCode()" id="btnClear">Clear</button>
      <button onclick="closeDoorModal()" id="btnCloseDoor">Close</button>
    </div>
  </div>
</div>

<!-- ========== MESSAGE MODAL ========== -->
<div id="modal" class="modal">
  <div class="modal-content">
    <p id="modalText"></p>
    <button onclick="closeModal()" id="btnOK">OK</button>
  </div>
</div>

<!-- Menu / Lobby Music -->
<audio id="menuMusic" loop>
  <source src="mixkit-xanthos-633.mp3" type="audio/mpeg">
</audio>

<!-- In-Room Music -->
<audio id="roomMusic" loop>
  <source src="halloween-spooky-eerie-music-416618.mp3" type="audio/mpeg">
</audio>


  <div id="doorModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <h2 id="doorModalTitle">Door Keypad</h2>
      <p id="doorModalText">Enter the code by clicking the digits you have found:</p>
      
      <div id="codeDisplay" style="font-size: 2rem; background: #000; padding: 10px; margin: 15px 0; letter-spacing: 5px; border: 2px solid var(--accent); color: var(--accent); text-align: center;">
        _ _ _
      </div>

      <div id="digitButtons" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;">
        </div>

      <div style="display: flex; gap: 10px;">
        <button onclick="submitDoorCode()" style="background: green; color: white; flex: 1;" id="btnSubmit">Submit</button>
        <button onclick="clearDoorCode()" style="background: #444; color: white; flex: 1;" id="btnClear">Clear</button>
      </div>
      <button onclick="closeDoorModal()" style="margin-top: 10px; background: transparent; border: 1px solid #777;" id="btnCloseDoor">Close</button>
    </div>
  </div>
  
<script>

// ========== LANGUAGE SYSTEM ==========
  let currentLanguage = 'en';
  
  const translations = {
    en: {
      mainTitle: 'üîë Escape‚Ä¶ if you can!',
      btnCurrentRoom: '‚ñ∂ Current Room',
      btnBrowseRooms: 'üåê Browse Rooms',
      btnSettings: '‚öô Settings',
      roomsTitle: 'Escape Rooms',
      searchPlaceholder: 'Search rooms',
      optDifficulty: 'Difficulty',
      optEasy: 'Easy',
      optMedium: 'Medium',
      optHard: 'Hard',
      optStatus: 'Status',
      optNew: 'Not Played',
      optProgress: 'In Progress',
      optDone: 'Completed',
      btnEnter: 'Enter',
      victoryTitle: 'üéâ You Escaped!',
      victoryText: 'You successfully completed the room!',
      btnBackToRooms: 'Back to Rooms',
      btnMainMenu: 'Main Menu',
      settingsTitle: 'Settings',
      btnAudioText: 'Audio',
      btnLanguageText: 'Language',
      btnControlsText: 'Controls',
      btnHelpText: 'How to Play',
      btnClose: 'Close',
      audioOn: 'On',
      audioOff: 'Off',
      langEnglish: 'English',
      langSpanish: 'Spanish',
      pauseTitle: 'Paused',
      btnResume: 'Resume',
      btnPauseSettings: 'Settings',
      btnQuit: 'Quit',
      doorModalTitle: 'Door Keypad',
      doorModalText: 'Enter the code by clicking the digits you have found',
      btnSubmit: 'Submit',
      btnClear: 'Clear',
      btnCloseDoor: 'Close',
      btnOK: 'OK',
      invLabel: 'Inventory',
      roomMysteryMansion: 'Mystery Mansion',
      roomMagicalLibrary: 'Magical Library',
      roomPirateCove: 'Pirate Cove',
      roomHauntedAsylum: 'Haunted Asylum',
      msgAlreadyFound: 'You already found this clue.',
      msgNothingElse: 'Nothing else remains here.',
      msgItemFound: 'You found a useful item!',
      msgNeedNumbers: 'You need to find some numbers first!',
      msgDoorUnlocked: 'The door is already unlocked.',
      msgIncorrectCode: 'Incorrect code. Keep looking for clues!',
      msgCodeIs3Digits: 'Code is 3 digits. Clear to re-enter.',
      msgControls: 'Click on hotspots to interact with them. Find clues hidden around the room to unlock the door.',
      msgHowToPlay: 'Find three number clues hidden around the room. Use them to unlock the door keypad and escape!',
      msgHotspotSaved: 'Hotspot positions saved.',
      msgSelectHotspot: 'Select a hotspot first'
    },
    es: {
      mainTitle: 'üîë ¬°Escapa‚Ä¶ si puedes!',
      btnCurrentRoom: '‚ñ∂ Sala Actual',
      btnBrowseRooms: 'üåê Explorar Salas',
      btnSettings: '‚öô Configuraci√≥n',
      roomsTitle: 'Salas de Escape',
      searchPlaceholder: 'Buscar salas',
      optDifficulty: 'Dificultad',
      optEasy: 'F√°cil',
      optMedium: 'Medio',
      optHard: 'Dif√≠cil',
      optStatus: 'Estado',
      optNew: 'No Jugado',
      optProgress: 'En Progreso',
      optDone: 'Completado',
      btnEnter: 'Entrar',
      victoryTitle: 'üéâ ¬°Has Escapado!',
      victoryText: '¬°Has completado la sala exitosamente!',
      btnBackToRooms: 'Volver a Salas',
      btnMainMenu: 'Men√∫ Principal',
      settingsTitle: 'Configuraci√≥n',
      btnAudioText: 'Audio',
      btnLanguageText: 'Idioma',
      btnControlsText: 'Controles',
      btnHelpText: 'C√≥mo Jugar',
      btnClose: 'Cerrar',
      audioOn: 'Activado',
      audioOff: 'Desactivado',
      langEnglish: 'Ingl√©s',
      langSpanish: 'Espa√±ol',
      pauseTitle: 'Pausado',
      btnResume: 'Reanudar',
      btnPauseSettings: 'Configuraci√≥n',
      btnQuit: 'Salir',
      doorModalTitle: 'Teclado de Puerta',
      doorModalText: 'Ingresa el c√≥digo haciendo clic en los d√≠gitos que encontraste',
      btnSubmit: 'Enviar',
      btnClear: 'Borrar',
      btnCloseDoor: 'Cerrar',
      btnOK: 'OK',
      invLabel: 'Inventario',
      roomMysteryMansion: 'Mansi√≥n Misteriosa',
      roomMagicalLibrary: 'Biblioteca M√°gica',
      roomPirateCove: 'Cala de Piratas',
      roomHauntedAsylum: 'Asilo Embrujado',
      msgAlreadyFound: 'Ya encontraste esta pista.',
      msgNothingElse: 'No queda nada m√°s aqu√≠.',
      msgItemFound: '¬°Encontraste un objeto √∫til!',
      msgNeedNumbers: '¬°Necesitas encontrar algunos n√∫meros primero!',
      msgDoorUnlocked: 'La puerta ya est√° desbloqueada.',
      msgIncorrectCode: '¬°C√≥digo incorrecto! Sigue buscando pistas.',
      msgCodeIs3Digits: 'El c√≥digo tiene 3 d√≠gitos. Borra para volver a ingresar.',
      msgControls: 'Haz clic en los puntos de inter√©s para interactuar con ellos.',
      msgHowToPlay: '¬°Encuentra tres pistas num√©ricas escondidas en la sala. √ösalas para desbloquear el teclado!',
      msgHotspotSaved: 'Posiciones de puntos guardadas.',
      msgSelectHotspot: 'Selecciona un punto primero'
    }
  };

  function updateLanguage() {
    const lang = translations[currentLanguage];
    document.getElementById('mainTitle').textContent = lang.mainTitle;
    document.getElementById('btnCurrentRoom').textContent = lang.btnCurrentRoom;
    document.getElementById('btnBrowseRooms').textContent = lang.btnBrowseRooms;
    document.getElementById('btnSettings').textContent = lang.btnSettings;
    document.getElementById('roomsTitle').textContent = lang.roomsTitle;
    document.getElementById('search').placeholder = lang.searchPlaceholder;
    document.getElementById('optDifficulty').textContent = lang.optDifficulty;
    document.getElementById('optEasy').textContent = lang.optEasy;
    document.getElementById('optMedium').textContent = lang.optMedium;
    document.getElementById('optHard').textContent = lang.optHard;
    document.getElementById('optStatus').textContent = lang.optStatus;
    document.getElementById('optNew').textContent = lang.optNew;
    document.getElementById('optProgress').textContent = lang.optProgress;
    document.getElementById('optDone').textContent = lang.optDone;
    document.getElementById('victoryTitle').textContent = lang.victoryTitle;
    document.getElementById('victoryText').textContent = lang.victoryText;
    document.getElementById('btnBackToRooms').textContent = lang.btnBackToRooms;
    document.getElementById('btnMainMenu').textContent = lang.btnMainMenu;
    document.getElementById('settingsTitle').textContent = lang.settingsTitle;
    document.getElementById('btnAudioText').textContent = lang.btnAudioText;
    document.getElementById('btnLanguageText').textContent = lang.btnLanguageText;
    document.getElementById('btnControlsText').textContent = lang.btnControlsText;
    document.getElementById('btnHelpText').textContent = lang.btnHelpText;
    document.getElementById('btnClose').textContent = lang.btnClose;
    document.getElementById('pauseTitle').textContent = lang.pauseTitle;
    document.getElementById('btnResume').textContent = lang.btnResume;
    document.getElementById('btnPauseSettings').textContent = lang.btnPauseSettings;
    document.getElementById('btnQuit').textContent = lang.btnQuit;
    document.getElementById('doorModalTitle').textContent = lang.doorModalTitle;
    document.getElementById('doorModalText').textContent = lang.doorModalText;
    document.getElementById('btnSubmit').textContent = lang.btnSubmit;
    document.getElementById('btnClear').textContent = lang.btnClear;
    document.getElementById('btnCloseDoor').textContent = lang.btnCloseDoor;
    document.getElementById('btnOK').textContent = lang.btnOK;
    document.getElementById('invLabel').textContent = lang.invLabel;
    document.getElementById('langStatus').textContent = currentLanguage === 'en' ? lang.langEnglish : lang.langSpanish;
    renderRooms();
    const roomData = roomsData[currentRoom];
    if (roomData) {
      document.getElementById('roomTitle').textContent = currentLanguage === 'en' ? roomData.titleEN : roomData.titleES;
    }
  }

  function changeLanguage() {
    currentLanguage = currentLanguage === 'en' ? 'es' : 'en';
    updateLanguage();
  }

  // ========== AUDIO SYSTEM ==========
  let audioEnabled = true;
  const menuMusic = document.getElementById("menuMusic");
  const roomMusic = document.getElementById("roomMusic");

  function toggleAudio() {
    audioEnabled = !audioEnabled;
    const lang = translations[currentLanguage];
    document.getElementById('audioStatus').textContent = audioEnabled ? lang.audioOn : lang.audioOff;
    if (audioEnabled) playMenuMusic();
    else { menuMusic.pause(); roomMusic.pause(); }
  }

  function playMenuMusic() {
    if (!audioEnabled) return;
    roomMusic.pause();
    roomMusic.currentTime = 0;
    menuMusic.volume = 0.25;
    if (menuMusic.paused) menuMusic.play().catch(()=>{});
  }

  function playRoomMusic() {
    if (!audioEnabled) return;
    menuMusic.pause();
    menuMusic.currentTime = 0;
    roomMusic.volume = 0.4;
    if (roomMusic.paused) roomMusic.play().catch(()=>{});
  }

  // ========== DATA & STATE ==========
  const roomsData = {
    'Mystery Mansion': {
      titleEN: 'Mystery Mansion ‚Äî Foyer',
      titleES: 'Mansi√≥n Misteriosa ‚Äî Vest√≠bulo',
      className: 'room-mystery',
      hotspotsId: 'hotspotsMysterv',
      image: 'images/foyer.jpg', 
      time: 300,
      code: '042',
      clues: {
        spot1: { number: 2, found: false, messageEN: 'You found a number hidden inside an old book!', messageES: '¬°Encontraste un n√∫mero escondido dentro de un libro viejo!' },
        spot2: { number: 0, found: false, messageEN: 'Behind the painting, a number is scratched into the wall!', messageES: '¬°Detr√°s de la pintura, un n√∫mero est√° grabado en la pared!' },
        spot3: { item: 'üß©', found: false, messageEN: 'You find a metal code plate! Might be useful for the safe.', messageES: '¬°Encuentras una placa de c√≥digo met√°lica! √ötil para la caja fuerte.' },
        spot4: { number: 4, found: false, messageEN: 'Under the rug, you discover a number carved into the floor!', messageES: '¬°Bajo la alfombra, descubres un n√∫mero tallado en el suelo!' },
        spot5: { item: 'üîê', found: false, messageEN: 'The safe opens! Inside is a heavy brass key.', messageES: '¬°La caja fuerte se abre! Dentro hay una llave de lat√≥n.' }
      }
    },
    'Magical Library': {
      titleEN: 'Magical Library ‚Äî Reading Room',
      titleES: 'Biblioteca M√°gica ‚Äî Sala de Lectura',
      className: 'room-library',
      hotspotsId: 'hotspotsLibrary',
      image: 'images/library.png',
      time: 240,
      code: 'none',
      requiresItems: ['üîÆ', 'üïØÔ∏è', 'üìú'],
      clues: {
        spot1: { item: 'üîÆ', found: false, messageEN: 'The crystal ball pulses with energy!', messageES: '¬°La bola de cristal pulsa con energ√≠a!' },
        spot2: { item: 'üìö', found: false, messageEN: 'You find an ancient book about secret doors.', messageES: 'Encuentras un libro antiguo sobre puertas secretas.' },
        spot3: { item: 'üïØÔ∏è', found: false, messageEN: 'An enchanted candle!', messageES: '¬°Una vela encantada!' },
        spot4: { item: 'üìú', found: false, messageEN: 'A mystical scroll with symbols.', messageES: 'Un pergamino m√≠stico con s√≠mbolos.' },
        spot5: { item: '‚ú®', found: false, messageEN: 'A vial of stardust!', messageES: '¬°Un frasco de polvo de estrellas!' }
      }
    },
    'Pirate Cove': {
      titleEN: 'Pirate Cove ‚Äî Captain\'s Quarters',
      titleES: 'Cala de Piratas ‚Äî Camarote del Capit√°n',
      className: 'room-pirate',
      hotspotsId: 'hotspotsPirate',
      image: 'images/pirate.jpg',
      time: 360,
      code: 'treasure',
      requiresItems: ['üó∫Ô∏è', '‚öì', 'üß≠', 'üóùÔ∏è'],
      clues: {
        spot1: { item: 'üó∫Ô∏è', found: false, messageEN: 'An old treasure map!', messageES: '¬°Un viejo mapa del tesoro!' },
        spot2: { item: 'üç∫', found: false, messageEN: 'A bottle of rum.', messageES: 'Una botella de ron.' },
        spot3: { item: 'üß≠', found: false, messageEN: 'A compass hidden in a crate!', messageES: '¬°Una br√∫jula en una caja!' },
        spot4: { item: '‚öì', found: false, messageEN: 'A golden anchor medallion!', messageES: '¬°Un medall√≥n de ancla dorado!' },
        spot5: { item: 'üóùÔ∏è', found: false, messageEN: 'A rusty key hidden in driftwood!', messageES: '¬°Una llave oxidada en la madera!' }
      }
    },
    'Haunted Asylum': {
      titleEN: 'Haunted Asylum ‚Äî Abandoned Ward',
      titleES: 'Asilo Embrujado ‚Äî Pabell√≥n Abandonado',
      className: 'room-asylum',
      hotspotsId: 'hotspotsAsylum',
      image: 'images/asylum.jpg',
      time: 420,
      code: '138',
      clues: {
        spot1: { number: 1, found: false, messageEN: 'You find patient record #1.', messageES: 'Encuentras el registro de paciente #1.' },
        spot2: { item: 'üì∫', found: false, messageEN: 'The TV flickers static.', messageES: 'La TV parpadea est√°tica.' },
        spot3: { number: 3, found: false, messageEN: 'The number 3 is written on the TV.', messageES: 'El n√∫mero 3 est√° escrito en la TV.' },
        spot4: { item: 'üíä', found: false, messageEN: 'Old medicine bottles.', messageES: 'Viejos frascos de medicina.' },
        spot5: { number: 8, found: false, messageEN: 'Scratched marks counting to 8.', messageES: 'Marcas que cuentan hasta 8.' }
      }
    }
  };

  const rooms = [
    { name: 'Mystery Mansion', difficulty: 'Medium', status: 'progress' },
    { name: 'Magical Library', difficulty: 'Easy', status: 'done' },
    { name: 'Pirate Cove', difficulty: 'Medium', status: 'new' },
    { name: 'Haunted Asylum', difficulty: 'Hard', status: 'new' }
  ];

  let time = 300;
  let interval = null;
  let paused = true;
  let currentRoom = 'Mystery Mansion';
  let doorEntry = '';
  let doorUnlocked = false;
  let DOOR_CODE = '042';
  let clues = roomsData['Mystery Mansion'].clues;

  const state = {
    inventory: [],
    foundDigits: [],
    selectedItem: null
  };

  // ========== CORE NAVIGATION ==========
  function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    if (['main', 'rooms', 'settings', 'victory'].includes(id)) playMenuMusic();
    else if (id === 'game') playRoomMusic();
  }

  function loadRoom(roomName) {
    currentRoom = roomName;
    const roomData = roomsData[roomName];
    document.getElementById('sceneImage').src = roomData.image;
    time = roomData.time;
    DOOR_CODE = roomData.code;
    clues = roomData.clues;
    paused = false;
    document.getElementById('roomTitle').textContent = currentLanguage === 'en' ? roomData.titleEN : roomData.titleES;
    document.getElementById('gameView').className = 'game-view ' + roomData.className;
    document.querySelectorAll('.hotspots-container').forEach(c => c.classList.add('hidden'));
    document.getElementById(roomData.hotspotsId).classList.remove('hidden');
    state.inventory = [];
    state.foundDigits = [];
    state.selectedItem = null;
    doorUnlocked = false;
    doorEntry = '';
    Object.keys(clues).forEach(k => clues[k].found = false);
    updateInventory();
    showScreen('game');
    startTimer();
  }

  function pauseGame() {
    paused = true;
    stopTimer();
    document.getElementById('game').classList.add('paused');
    document.getElementById('menuOverlay').style.display = 'flex';
  }

  function resumeGame() {
    closeMenu();
    document.getElementById('game').classList.remove('paused');
    showScreen('game');
    if (paused) { paused = false; startTimer(); }
  }

  function closeMenu() { document.getElementById('menuOverlay').style.display = 'none'; }

  function startTimer() {
    clearInterval(interval);
    interval = setInterval(() => {
      if (time <= 0) { clearInterval(interval); alert("Time's up!"); showScreen('main'); return; }
      time--;
      const m = String(Math.floor(time / 60)).padStart(2, '0');
      const s = String(time % 60).padStart(2, '0');
      document.getElementById('timer').textContent = `${m}:${s}`;
    }, 1000);
  }
  function stopTimer() { clearInterval(interval); }

  // ========== INTERACTIONS ==========
  function interact(spotKey) {
    const clue = clues[spotKey];
    if (!clue) return;
    if (clue.found) { showModal(translations[currentLanguage].msgNothingElse); return; }

    // Mystery Mansion Safe Logic
    if (spotKey === 'spot5' && currentRoom === 'Mystery Mansion' && !state.inventory.includes('üß©')) {
      showModal(currentLanguage === 'en' ? 'The safe is locked. You need a code plate.' : 'La caja fuerte est√° cerrada.');
      return;
    }

    clue.found = true;
    if (clue.number !== undefined) {
      state.foundDigits.push(String(clue.number));
    } else if (clue.item) {
      state.inventory.push(clue.item);
    }
    updateInventory();
    showModal(currentLanguage === 'en' ? clue.messageEN : clue.messageES);
  }

  function tryDoor() {
    const lang = translations[currentLanguage];
    const roomData = roomsData[currentRoom];

    // Room Exit Logic
    if (currentRoom === 'Magical Library') {
      const hasAll = roomData.requiresItems.every(i => state.inventory.includes(i));
      if (!hasAll) { showModal(currentLanguage === 'en' ? 'The bookshelf won\'t move. Collect the Crystal, Candle, and Scroll.' : 'La estanter√≠a no se mueve.'); return; }
      winRoom();
    } else if (currentRoom === 'Pirate Cove') {
      const hasAll = roomData.requiresItems.every(i => state.inventory.includes(i));
      if (!hasAll) { showModal(currentLanguage === 'en' ? 'You need the Map, Anchor, Compass, and Key to find the treasure.' : 'Necesitas los objetos del pirata.'); return; }
      winRoom();
    } else {
      // Keypad Rooms
      if (doorUnlocked) winRoom();
      else if (state.foundDigits.length === 0) showModal(lang.msgNeedNumbers);
      else openDoorModal();
    }
  }

  function winRoom() {
    showScreen('victory');
    stopTimer();
  }

  // ========== KEYPAD MODAL ==========
  function openDoorModal() {
    const modal = document.getElementById('doorModal');
    modal.classList.remove('hidden');
    modal.style.display = 'flex';
    doorEntry = '';
    updateCodeDisplay();
    renderDigitButtons();
  }

  function closeDoorModal() {
    document.getElementById('doorModal').style.display = 'none';
  }

  function renderDigitButtons() {
    const container = document.getElementById('digitButtons');
    container.innerHTML = '';
    for (let i = 0; i <= 9; i++) {
      const btn = document.createElement('button');
      btn.className = 'digit';
      btn.textContent = i;
      if (!state.foundDigits.includes(String(i))) {
        btn.classList.add('digit-disabled');
        btn.disabled = true;
      } else {
        btn.onclick = () => { if (doorEntry.length < 3) { doorEntry += i; updateCodeDisplay(); }};
      }
      container.appendChild(btn);
    }
  }

  function updateCodeDisplay() {
    document.getElementById('codeDisplay').textContent = doorEntry.padEnd(3, '_').split('').join(' ');
  }

  function clearDoorCode() { doorEntry = ''; updateCodeDisplay(); }

  function submitDoorCode() {
    if (doorEntry === DOOR_CODE) {
      doorUnlocked = true;
      closeDoorModal();
      showModal(currentLanguage === 'en' ? 'Correct! The door is open.' : '¬°Correcto!');
    } else {
      showModal(translations[currentLanguage].msgIncorrectCode);
      clearDoorCode();
    }
  }

  // ========== UI UPDATES ==========
  function renderRooms() {
    const grid = document.getElementById('roomGrid');
    grid.innerHTML = '';
    const s = document.getElementById('search').value.toLowerCase();
    const d = document.getElementById('difficulty').value;
    const st = document.getElementById('status').value;
    const lang = translations[currentLanguage];

    rooms.filter(r => (!s || r.name.toLowerCase().includes(s)) && (!d || r.difficulty === d) && (!st || r.status === st))
      .forEach(r => {
        const c = document.createElement('div');
        c.className = 'card';
        const name = currentLanguage === 'es' ? (lang['room' + r.name.replace(/\s+/g, '')] || r.name) : r.name;
        c.innerHTML = `<strong>${name}</strong><br>${r.difficulty}<br>${r.status}`;
        const b = document.createElement('button');
        b.textContent = lang.btnEnter;
        b.onclick = () => loadRoom(r.name);
        c.appendChild(b);
        grid.appendChild(c);
      });
  }

  function updateInventory() {
    const inv = document.getElementById('invItems');
    inv.innerHTML = '';
    state.inventory.forEach(item => {
      const el = document.createElement('div');
      el.className = 'inv-item';
      el.textContent = item;
      inv.appendChild(el);
    });
    state.foundDigits.forEach(d => {
      const el = document.createElement('div');
      el.className = 'inv-item clue-badge';
      el.textContent = d;
      inv.appendChild(el);
    });
  }

  function showModal(text) {
    document.getElementById('modalText').textContent = text;
    document.getElementById('modal').style.display = 'flex';
  }

  function closeModal() { document.getElementById('modal').style.display = 'none'; }
  function toggleFilterMenu() { document.getElementById('filterMenu').classList.toggle('hidden'); }
  function showControls() { showModal(translations[currentLanguage].msgControls); }
  function showHowToPlay() { showModal(translations[currentLanguage].msgHowToPlay); }

  // ========== INIT ==========
  window.addEventListener('DOMContentLoaded', () => {
    updateLanguage();
    playMenuMusic();
  });

</script>
</body>
</html>
