<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Escape‚Ä¶ if you can!</title>
  <style>
    /* ========== VARIABLES ========== */
    :root {
      --bg: #1e1e2f;
      --panel: #2a2a40;
      --accent: #c9a227;
      --text: #f5f5f5;
    }

    /* ========== BASE STYLES ========== */
    * {
      box-sizing: border-box;
      font-family: system-ui, sans-serif;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
    }

    .app {
      max-width: 1100px;
      margin: auto;
      padding: 16px;
    }

    h1, h2, h3 {
      margin-bottom: 12px;
    }

    /* ========== SCREEN NAVIGATION ========== */
    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    /* ========== BUTTONS ========== */
    button {
      width: 100%;
      padding: 14px;
      margin: 8px 0;
      border: none;
      border-radius: 8px;
      background: var(--accent);
      color: #000;
      font-size: 1rem;
      cursor: pointer;
      font-weight: 600;
    }

    button.secondary {
      background: #444;
      color: #fff;
    }

    /* ========== FORM INPUTS ========== */
    select, input {
      padding: 6px;
      border-radius: 6px;
      border: none;
    }

    /* ========== CARD GRID ========== */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 12px;
    }

    .card {
      background: var(--panel);
      border-radius: 10px;
      padding: 12px;
    }

    /* ========== ROOMS SCREEN ========== */
    .rooms-topbar {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .rooms-header {
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .rooms-search {
      position: relative;
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
      flex-wrap: nowrap;
    }

    .back-btn {
      width: 28px;
      height: 28px;
      padding: 0;
      border-radius: 6px;
      font-size: 16px;
      background: #444;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      margin-right: 8px;
    }

    .search-input {
      flex: 1;
      max-width: 260px;
      min-width: 0;
      padding: 8px 10px;
      border-radius: 6px;
      border: none;
    }

    .filter-anchor {
      position: relative;
    }

    .filter-btn {
      width: 32px;
      height: 32px;
      border-radius: 6px;
      font-size: 20px;
      background: #444;
      color: #fff;
      padding: 0;
      margin: 0;
    }

    .filter-menu {
      position: absolute;
      top: 50%;
      left: calc(100% + 8px);
      transform: translateY(-50%);
      background: var(--panel);
      padding: 10px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 999;
      min-width: 160px;
    }

    /* ========== GAME SCREEN ========== */
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 8px;
    }

    .game {
      background: var(--panel);
      border-radius: 12px;
      padding: 12px;
    }

    .game-view {
      position: relative;
      width: 100%;
      aspect-ratio: 3 / 2;
      max-height: 66vh;
      border-radius: 10px;
      margin-bottom: 8px;
      background-color: #111;
      overflow: hidden;
    }

    .game-view img#sceneImage {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      z-index: 1;
    }

    /* ========== HOTSPOTS ========== */
    .hotspot {
      position: absolute;
      background: rgba(255, 0, 0, 0.05);
      border: none;
      cursor: pointer;
      z-index: 50;
    }

    .hotspot:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    /* Mystery Mansion */
    .room-mystery .hotspot.books { left: 20%; top: 53%; width: 6.6%; height: 15%; }
    .room-mystery .hotspot.painting { left: 44%; top: 6%; width: 13%; height: 25%; }
    .room-mystery .hotspot.fireplace { left: 40%; top: 33%; width: 20%; height: 27%; }
    .room-mystery .hotspot.rug { left: 36%; top: 70%; width: 26%; height: 15%; }
    .room-mystery .hotspot.safe { left: 73%; top: 70%; width: 5%; height: 10%; }
    .room-mystery .hotspot.door { left: 73%; top: 25%; width: 10%; height: 35%; }

    /* Magical Library */
    .room-library .hotspot.crystal { left: 40%; top: 35%; width: 6%; height: 5%; }
    .room-library .hotspot.bookshelf { left: 8%; top: 5%; width: 5%; height: 5%; }
    .room-library .hotspot.candles { left: 48%; top: 28%; width: 8%; height: 13%; }
    .room-library .hotspot.scroll { left: 18%; top: 83%; width: 5%; height: 5%; }
    .room-library .hotspot.chest { left: 46%; top: 15%; width: 12%; height: 12%; }
    .room-library .hotspot.door { left: 63%; top: 8%; width: 18%; height: 45%; }

    /* Pirate Cove */
    .room-pirate .hotspot.map { left: 4%; top: 48%; width: 8%; height: 10%; }
    .room-pirate .hotspot.barrel { left: 25%; top: 58%; width: 3%; height: 10%; }
    .room-pirate .hotspot.crates { left: 15%; top: 68%; width: 10%; height: 12%; }
    .room-pirate .hotspot.campfire { left: 45%; top: 55%; width: 5%; height: 8%; }
    .room-pirate .hotspot.sand { left: 70%; top: 60%; width: 5%; height: 5%; }
    .room-pirate .hotspot.door { left: 63%; top: 68%; width: 8%; height: 8%; }

    /* Haunted Asylum */
    .room-asylum .hotspot.bed { left: 54%; top: 30%; width: 14%; height: 32%; transform: rotate(35deg); }
    .room-asylum .hotspot.tv { left: 35%; top: 59%; width: 12%; height: 18%; }
    .room-asylum .hotspot.paper { left: 36%; top: 53%; width: 5%; height: 4%; }
    .room-asylum .hotspot.firstaid { left: 28%; top: 5%; width: 8%; height: 30%; }
    .room-asylum .hotspot.pipe { left: 8%; top: 5%; width: 6%; height: 20%; }
    .room-asylum .hotspot.door { left: 83%; top: 8%; width: 15%; height: 50%; }

    /* ========== INVENTORY ========== */
    .inventory {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px;
      background: rgba(0, 0, 0, 0.14);
      border-radius: 8px;
      margin-top: 8px;
    }

    .inv-items { display: flex; gap: 8px; flex-wrap: wrap; }

    .inv-item {
      width: 36px;
      height: 36px;
      border-radius: 6px;
      background: #fff;
      color: #111;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
    }

    .inv-item.selected { outline: 3px solid var(--accent); }

    .clue-badge {
      background: #fef6e3;
      font-weight: 700;
      border: 1px solid rgba(201, 162, 39, 0.25);
    }

    /* ========== DOOR KEYPAD ========== */
    #codeDisplay {
      font-family: monospace;
      text-align: center;
      padding: 8px;
      background: #fff;
      color: #111;
      border-radius: 8px;
      display: block;
      width: 100%;
      font-weight: 700;
      margin: 8px 0;
      letter-spacing: 10px;
      font-size: 26px;
    }

    #digitButtons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
      margin: 12px 0;
    }

    #digitButtons .digit {
      width: 44px;
      height: 44px;
      border-radius: 8px;
      background: #eee;
      border: 1px solid #ccc;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* ========== MODALS ========== */
    .menu-overlay, .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    .menu, .modal-content {
      background: var(--panel);
      padding: 20px;
      border-radius: 12px;
      width: 320px;
      text-align: center;
    }

    .hidden { display: none !important; }

  </style>
</head>
<body>

<div class="app">
  <section id="main" class="screen active">
    <h1 id="mainTitle">üîë Escape‚Ä¶ if you can!</h1>
    <button onclick="resumeGame()" id="btnCurrentRoom">‚ñ∂ Current Room</button>
    <button onclick="showScreen('rooms')" id="btnBrowseRooms">üåê Browse Rooms</button>
    <button onclick="showScreen('settings')" id="btnSettings">‚öô Settings</button>
  </section>

  <section id="rooms" class="screen">
    <div class="topbar rooms-topbar">
      <div class="rooms-header">
        <h2 id="roomsTitle">Escape Rooms</h2>
      </div>
      <div class="rooms-search">
        <button class="back-btn" onclick="showScreen('main')">‚Üê</button>
        <input id="search" class="search-input" placeholder="Search rooms" oninput="renderRooms()" />
        <div class="filter-anchor">
          <button class="filter-btn" onclick="toggleFilterMenu()">‚ãØ</button>
          <div id="filterMenu" class="filter-menu hidden">
            <select id="difficulty" onchange="renderRooms()">
              <option value="" id="optDifficulty">Difficulty</option>
              <option id="optEasy">Easy</option>
              <option id="optMedium">Medium</option>
              <option id="optHard">Hard</option>
            </select>
          </div>
        </div>
      </div>
    </div>
    <div id="roomGrid" class="grid" style="margin-top:12px"></div>
  </section>

  <section id="game" class="screen">
    <div class="topbar">
      <button class="secondary" onclick="pauseGame()" style="width:44px;height:44px;padding:0;">‚ò∞</button>
      <strong id="roomTitle">Mystery Mansion</strong>
      <span id="timer">05:00</span>
    </div>

    <div class="game">
      <div class="game-view" id="gameView">
        <img id="sceneImage" src="" alt="Scene" />

        <div id="hotspotsMystery" class="hotspots-container">
          <button class="hotspot books" onclick="interact('spot1')"></button>
          <button class="hotspot painting" onclick="interact('spot2')"></button>
          <button class="hotspot fireplace" onclick="interact('spot3')"></button>
          <button class="hotspot rug" onclick="interact('spot4')"></button>
          <button class="hotspot safe" onclick="interact('spot5')"></button>
          <button class="hotspot door" onclick="tryDoor()"></button>
        </div>

        <div id="hotspotsLibrary" class="hotspots-container hidden">
          <button class="hotspot crystal" onclick="interact('spot1')"></button>
          <button class="hotspot bookshelf" onclick="interact('spot2')"></button>
          <button class="hotspot candles" onclick="interact('spot3')"></button>
          <button class="hotspot scroll" onclick="interact('spot4')"></button>
          <button class="hotspot chest" onclick="interact('spot5')"></button>
          <button class="hotspot door" onclick="tryDoor()"></button>
        </div>

        <div id="hotspotsPirate" class="hotspots-container hidden">
          <button class="hotspot map" onclick="interact('spot1')"></button>
          <button class="hotspot barrel" onclick="interact('spot2')"></button>
          <button class="hotspot crates" onclick="interact('spot3')"></button>
          <button class="hotspot campfire" onclick="interact('spot4')"></button>
          <button class="hotspot sand" onclick="interact('spot5')"></button>
          <button class="hotspot door" onclick="tryDoor()"></button>
        </div>

        <div id="hotspotsAsylum" class="hotspots-container hidden">
          <button class="hotspot bed" onclick="interact('spot1')"></button>
          <button class="hotspot tv" onclick="interact('spot2')"></button>
          <button class="hotspot paper" onclick="interact('spot3')"></button>
          <button class="hotspot firstaid" onclick="interact('spot4')"></button>
          <button class="hotspot pipe" onclick="interact('spot5')"></button>
          <button class="hotspot door" onclick="tryDoor()"></button>
        </div>
      </div>

      <div class="inventory" id="inventory">
        <div class="inv-label" id="invLabel">Inventory</div>
        <div class="inv-items" id="invItems"></div>
      </div>
    </div>
  </section>

  <section id="victory" class="screen">
    <h1 id="victoryTitle">üéâ You Escaped!</h1>
    <p id="victoryText">You successfully completed the room!</p>
    <button onclick="showScreen('rooms')" id="btnBackToRooms">Back to Rooms</button>
  </section>

  <section id="settings" class="screen">
    <h2 id="settingsTitle">Settings</h2>
    <button onclick="changeLanguage()">üåê <span id="langStatus">English</span></button>
    <button onclick="showHowToPlay()">‚ùì How to Play</button>
    <button onclick="showScreen('main')">Close</button>
  </section>
</div>

<div id="menuOverlay" class="menu-overlay">
  <div class="menu">
    <h3 id="pauseTitle">Paused</h3>
    <button onclick="resumeGame()">Resume</button>
    <button onclick="showScreen('main'); closeMenu()">Quit</button>
  </div>
</div>

<div id="doorModal" class="modal">
  <div class="modal-content">
    <h3 id="doorModalTitle">Door Keypad</h3>
    <p id="doorModalText">Enter the code</p>
    <div id="codeDisplay">___</div>
    <div id="digitButtons"></div>
    <button onclick="submitDoorCode()">Submit</button>
    <button onclick="clearDoorCode()" class="secondary">Clear</button>
    <button onclick="closeDoorModal()" class="secondary">Close</button>
  </div>
</div>

<div id="modal" class="modal">
  <div class="modal-content">
    <p id="modalText"></p>
    <button onclick="closeModal()">OK</button>
  </div>
</div>

<script>
  let currentLanguage = 'en';
  let currentRoom = 'Mystery Mansion';
  let time = 300;
  let interval = null;
  let paused = true;
  let doorEntry = '';
  let doorUnlocked = false;

  const state = {
    inventory: [],
    foundDigits: []
  };

  const translations = {
    en: {
      mainTitle: 'üîë Escape‚Ä¶ if you can!',
      msgNeedNumbers: 'You need to find some numbers first!',
      msgDoorUnlocked: 'The door is already unlocked.',
      msgIncorrectCode: 'Incorrect code!',
      msgHowToPlay: 'Find hidden numbers or items to unlock the door and escape!',
      btnEnter: 'Enter'
    },
    es: {
      mainTitle: 'üîë ¬°Escapa‚Ä¶ si puedes!',
      msgNeedNumbers: '¬°Necesitas encontrar n√∫meros primero!',
      msgDoorUnlocked: 'La puerta ya est√° abierta.',
      msgIncorrectCode: '¬°C√≥digo incorrecto!',
      msgHowToPlay: '¬°Encuentra n√∫meros o objetos para abrir la puerta y escapar!',
      btnEnter: 'Entrar'
    }
  };

  const roomsData = {
    'Mystery Mansion': {
      className: 'room-mystery',
      hotspotsId: 'hotspotsMystery',
      image: 'images/foyer.jpg',
      time: 300,
      code: '042',
      clues: {
        spot1: { number: 2, messageEN: 'Number 2 found in a book!', messageES: '¬°N√∫mero 2 en un libro!' },
        spot2: { number: 0, messageEN: 'Number 0 behind the painting!', messageES: '¬°N√∫mero 0 tras el cuadro!' },
        spot3: { item: 'üß©', messageEN: 'Found a puzzle piece!', messageES: '¬°Pieza de puzzle encontrada!' },
        spot4: { number: 4, messageEN: 'Number 4 under the rug!', messageES: '¬°N√∫mero 4 bajo la alfombra!' },
        spot5: { item: 'üîê', messageEN: 'Safe opened!', messageES: '¬°Caja abierta!' }
      }
    },
    'Magical Library': {
      className: 'room-library',
      hotspotsId: 'hotspotsLibrary',
      image: 'images/library.png',
      time: 240,
      code: 'none',
      requiresItems: ['üîÆ', 'üïØÔ∏è', 'üìú'],
      clues: {
        spot1: { item: 'üîÆ', messageEN: 'Crystal Ball found!', messageES: '¬°Bola de cristal!' },
        spot2: { item: 'üìö', messageEN: 'Ancient Tome!', messageES: '¬°Tomo antiguo!' },
        spot3: { item: 'üïØÔ∏è', messageEN: 'Magic Candle!', messageES: '¬°Vela m√°gica!' },
        spot4: { item: 'üìú', messageEN: 'Magic Scroll!', messageES: '¬°Pergamino!' },
        spot5: { item: '‚ú®', messageEN: 'Stardust!', messageES: '¬°Polvo estelar!' }
      }
    },
    'Pirate Cove': {
      className: 'room-pirate',
      hotspotsId: 'hotspotsPirate',
      image: 'images/pirate.jpg',
      time: 360,
      code: 'none',
      requiresItems: ['üó∫Ô∏è', '‚öì', 'üß≠', 'üóùÔ∏è'],
      clues: {
        spot1: { item: 'üó∫Ô∏è', messageEN: 'Treasure Map!', messageES: '¬°Mapa del tesoro!' },
        spot2: { item: 'üç∫', messageEN: 'Old Rum!', messageES: '¬°Ron antiguo!' },
        spot3: { item: 'üß≠', messageEN: 'Compass!', messageES: '¬°Br√∫jula!' },
        spot4: { item: '‚öì', messageEN: 'Golden Anchor!', messageES: '¬°Ancla de oro!' },
        spot5: { item: 'üóùÔ∏è', messageEN: 'Rusty Key!', messageES: '¬°Llave oxidada!' }
      }
    },
    'Haunted Asylum': {
      className: 'room-asylum',
      hotspotsId: 'hotspotsAsylum',
      image: 'images/asylum.jpg',
      time: 420,
      code: '138',
      clues: {
        spot1: { number: 1, messageEN: 'Found number 1!', messageES: '¬°N√∫mero 1!' },
        spot2: { item: 'üì∫', messageEN: 'TV Static...', messageES: 'Est√°tica...' },
        spot3: { number: 3, messageEN: 'Found number 3!', messageES: '¬°N√∫mero 3!' },
        spot4: { item: 'üíä', messageEN: 'Medicine!', messageES: '¬°Medicina!' },
        spot5: { number: 8, messageEN: 'Found number 8!', messageES: '¬°N√∫mero 8!' }
      }
    }
  };

  const rooms = [
    { name: 'Mystery Mansion', difficulty: 'Medium', status: 'new' },
    { name: 'Magical Library', difficulty: 'Easy', status: 'new' },
    { name: 'Pirate Cove', difficulty: 'Medium', status: 'new' },
    { name: 'Haunted Asylum', difficulty: 'Hard', status: 'new' }
  ];

  function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function renderRooms() {
    const grid = document.getElementById('roomGrid');
    grid.innerHTML = '';
    const search = document.getElementById('search').value.toLowerCase();
    rooms.filter(r => r.name.toLowerCase().includes(search)).forEach(r => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `<strong>${r.name}</strong><br>Difficulty: ${r.difficulty}`;
      const btn = document.createElement('button');
      btn.textContent = translations[currentLanguage].btnEnter;
      btn.onclick = () => loadRoom(r.name);
      card.appendChild(btn);
      grid.appendChild(card);
    });
  }

  function loadRoom(name) {
    currentRoom = name;
    const data = roomsData[name];
    document.getElementById('sceneImage').src = data.image;
    document.getElementById('roomTitle').textContent = name;
    
    document.querySelectorAll('.hotspots-container').forEach(c => c.classList.add('hidden'));
    document.getElementById(data.hotspotsId).classList.remove('hidden');
    document.getElementById('gameView').className = 'game-view ' + data.className;

    time = data.time;
    state.inventory = [];
    state.foundDigits = [];
    doorEntry = '';
    doorUnlocked = false;
    
    updateInventory();
    showScreen('game');
    startTimer();
  }

  function interact(spotKey) {
    const data = roomsData[currentRoom];
    const clue = data.clues[spotKey];
    if (clue.number !== undefined) {
      if (!state.foundDigits.includes(String(clue.number))) {
        state.foundDigits.push(String(clue.number));
      }
    } else if (clue.item) {
      if (!state.inventory.includes(clue.item)) {
        state.inventory.push(clue.item);
      }
    }
    showModal(currentLanguage === 'en' ? clue.messageEN : clue.messageES);
    updateInventory();
  }

  function tryDoor() {
    const data = roomsData[currentRoom];
    if (data.requiresItems) {
      const hasAll = data.requiresItems.every(i => state.inventory.includes(i));
      if (hasAll) {
        showScreen('victory');
      } else {
        showModal("You are missing items to unlock this!");
      }
    } else {
      if (state.foundDigits.length === 0) {
        showModal(translations[currentLanguage].msgNeedNumbers);
      } else {
        openDoorModal();
      }
    }
  }

  function openDoorModal() {
    doorEntry = '';
    updateCodeDisplay();
    const btnContainer = document.getElementById('digitButtons');
    btnContainer.innerHTML = '';
    state.foundDigits.forEach(d => {
      const btn = document.createElement('button');
      btn.className = 'digit';
      btn.textContent = d;
      btn.onclick = () => {
        if (doorEntry.length < 3) {
          doorEntry += d;
          updateCodeDisplay();
        }
      };
      btnContainer.appendChild(btn);
    });
    document.getElementById('doorModal').style.display = 'flex';
  }

  function updateCodeDisplay() {
    document.getElementById('codeDisplay').textContent = doorEntry.padEnd(3, '_');
  }

  function submitDoorCode() {
    const data = roomsData[currentRoom];
    if (doorEntry === data.code) {
      closeDoorModal();
      showScreen('victory');
    } else {
      showModal(translations[currentLanguage].msgIncorrectCode);
      doorEntry = '';
      updateCodeDisplay();
    }
  }

  function clearDoorCode() {
    doorEntry = '';
    updateCodeDisplay();
  }

  function closeDoorModal() {
    document.getElementById('doorModal').style.display = 'none';
  }

  function updateInventory() {
    const container = document.getElementById('invItems');
    container.innerHTML = '';
    state.inventory.forEach(i => {
      const div = document.createElement('div');
      div.className = 'inv-item';
      div.textContent = i;
      container.appendChild(div);
    });
    state.foundDigits.forEach(d => {
      const div = document.createElement('div');
      div.className = 'inv-item clue-badge';
      div.textContent = d;
      container.appendChild(div);
    });
  }

  function startTimer() {
    clearInterval(interval);
    interval = setInterval(() => {
      time--;
      if (time <= 0) { clearInterval(interval); showScreen('main'); }
      const m = Math.floor(time / 60);
      const s = time % 60;
      document.getElementById('timer').textContent = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    }, 1000);
  }

  function pauseGame() {
    document.getElementById('menuOverlay').style.display = 'flex';
    clearInterval(interval);
  }

  function resumeGame() {
    if (document.getElementById('game').classList.contains('active')) {
        startTimer();
    } else {
        loadRoom('Mystery Mansion');
    }
    closeMenu();
  }

  function closeMenu() { document.getElementById('menuOverlay').style.display = 'none'; }
  function showModal(t) { document.getElementById('modalText').textContent = t; document.getElementById('modal').style.display = 'flex'; }
  function closeModal() { document.getElementById('modal').style.display = 'none'; }
  function toggleFilterMenu() { document.getElementById('filterMenu').classList.toggle('hidden'); }
  function changeLanguage() { 
    currentLanguage = currentLanguage === 'en' ? 'es' : 'en'; 
    document.getElementById('langStatus').textContent = currentLanguage === 'en' ? 'English' : 'Espa√±ol';
    document.getElementById('mainTitle').textContent = translations[currentLanguage].mainTitle;
    renderRooms();
  }
  function showHowToPlay() { showModal(translations[currentLanguage].msgHowToPlay); }

  renderRooms();
</script>
</body>
</html>
