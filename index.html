<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Escapeâ€¦ if you can!</title>
  <style>
    /* ========== VARIABLES ========== */
    :root {
      --bg: #1e1e2f;
      --panel: #2a2a40;
      --accent: #c9a227;
      --text: #f5f5f5;
    }

    /* ========== BASE STYLES ========== */
    * { box-sizing: border-box; font-family: system-ui, sans-serif; }
    body { margin: 0; background: var(--bg); color: var(--text); }
    .app { max-width: 1100px; margin: auto; padding: 16px; }
    
    /* ========== BUTTONS ========== */
    button {
      width: 100%; padding: 14px; margin: 8px 0; border: none;
      border-radius: 8px; background: var(--accent); color: #000;
      font-size: 1rem; cursor: pointer; font-weight: 600;
    }
    button.secondary { background: #444; color: #fff; }

    /* ========== SCREEN NAVIGATION ========== */
    .screen { display: none; }
    .screen.active { display: block; }

    /* ========== ROOMS BROWSER ========== */
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 12px; }
    .card { background: var(--panel); border-radius: 10px; padding: 12px; }
    .topbar { display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 8px; }

    /* ========== GAME VIEW ========== */
    .game-view {
      position: relative; width: 100%; aspect-ratio: 3 / 2; max-height: 66vh;
      border-radius: 10px; background-color: #111; overflow: hidden;
    }
    .game-view img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: contain; z-index: 1; }

    /* ========== HOTSPOTS (Clues) ========== */
    .hotspot {
      position: absolute; background: transparent !important; border: none;
      cursor: pointer; z-index: 50; outline: none;
    }
    /* Positions */
    .room-mystery .hotspot.painting { left: 44%; top: 6%; width: 13%; height: 25%; }
    .room-mystery .hotspot.fireplace { left: 40%; top: 33%; width: 20%; height: 27%; }
    .room-mystery .hotspot.door { left: 73%; top: 25%; width: 10%; height: 35%; }
    .room-mystery .hotspot.safe { left: 73%; top: 70%; width: 5%; height: 10%; }
    .room-mystery .hotspot.rug { left: 36%; top: 70%; width: 26%; height: 15%; }
    .room-mystery .hotspot.books { left: 20%; top: 53%; width: 6%; height: 15%; }

    /* ========== INVENTORY ========== */
    .inventory { display: flex; gap: 12px; padding: 8px; background: rgba(0,0,0,0.2); border-radius: 8px; margin-top: 8px; }
    .inv-item { width: 40px; height: 40px; background: #fff; color: #000; display: flex; align-items: center; justify-content: center; border-radius: 4px; font-weight: bold; }

    /* ========== KEYPAD (No Highlights) ========== */
    #codeDisplay {
      font-family: monospace; text-align: center; padding: 10px; background: #000;
      color: var(--accent); border-radius: 8px; font-size: 26px; letter-spacing: 10px; margin-bottom: 15px;
    }
    #digitButtons { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px; }
    
    .digit {
      padding: 15px; background: #222 !important; color: #fff !important;
      border: 1px solid #444; border-radius: 6px; cursor: pointer; outline: none;
    }
    /* Force disabled and enabled buttons to look identical */
    .digit:disabled { opacity: 1; cursor: default; }
    .digit:active { background: #333 !important; }

    /* ========== MODALS ========== */
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 1000; }
    .modal-content { background: var(--panel); padding: 20px; border-radius: 12px; text-align: center; width: 300px; }
    .hidden { display: none !important; }
  </style>
</head>
<body>
<div class="app">

  <section id="main" class="screen active">
    <h1>ðŸ”‘ Escape Room</h1>
    <button onclick="showScreen('rooms')">Browse Rooms</button>
  </section>

  <section id="rooms" class="screen">
    <div id="roomGrid" class="grid"></div>
  </section>

  <section id="game" class="screen">
    <div class="topbar">
      <button onclick="showScreen('main')" style="width:50px">Back</button>
      <strong id="roomTitle">Room</strong>
      <span id="timer">05:00</span>
    </div>
    <div class="game-view" id="gameView">
      <img id="sceneImage" src="" />
      <div id="hotspotsMystery" class="hotspots-container">
        <button class="hotspot books" title="Inspect books" onclick="interact('spot1')"></button>
        <button class="hotspot painting" title="Inspect painting" onclick="interact('spot2')"></button>
        <button class="hotspot fireplace" title="Inspect fireplace" onclick="interact('spot3')"></button>
        <button class="hotspot rug" title="Lift rug" onclick="interact('spot4')"></button>
        <button class="hotspot safe" title="Inspect safe" onclick="interact('spot5')"></button>
        <button class="hotspot door" title="Try door" onclick="tryDoor()"></button>
      </div>
    </div>
    <div class="inventory" id="invItems"></div>
  </section>

  <section id="victory" class="screen">
    <h1>ðŸŽ‰ You Escaped!</h1>
    <button onclick="showScreen('main')">Main Menu</button>
  </section>
</div>

<div id="doorModal" class="modal">
  <div class="modal-content">
    <h3>Door Keypad</h3>
    <div id="codeDisplay">_ _ _</div>
    <div id="digitButtons"></div>
    <div style="display:flex; gap:5px">
      <button onclick="submitCode()" style="background:green; color:white">Submit</button>
      <button onclick="clearCode()" style="background:#666; color:white">Clear</button>
    </div>
    <button onclick="closeKeypad()" style="background:none; color:gray; font-size:0.8rem">Close</button>
  </div>
</div>

<script>
  const state = { foundDigits: [], currentEntry: '' };
  let currentRoomData = null;

  const rooms = {
    'Mystery Mansion': {
      image: 'images/foyer.jpg',
      code: '042',
      clues: {
        spot1: { num: '2', msg: 'Found a 2!' },
        spot2: { num: '0', msg: 'Found a 0!' },
        spot4: { num: '4', msg: 'Found a 4!' }
      }
    }
  };

  function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function renderRooms() {
    const grid = document.getElementById('roomGrid');
    Object.keys(rooms).forEach(name => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `<strong>${name}</strong><br><button onclick="loadRoom('${name}')">Enter</button>`;
      grid.appendChild(card);
    });
  }

  function loadRoom(name) {
    currentRoomData = rooms[name];
    document.getElementById('sceneImage').src = currentRoomData.image;
    document.getElementById('roomTitle').textContent = name;
    state.foundDigits = [];
    updateInv();
    showScreen('game');
  }

  function interact(key) {
    const clue = currentRoomData.clues[key];
    if (clue && !state.foundDigits.includes(clue.num)) {
      state.foundDigits.push(clue.num);
      alert(clue.msg);
      updateInv();
    }
  }

  function updateInv() {
    const container = document.getElementById('invItems');
    container.innerHTML = '';
    state.foundDigits.forEach(d => {
      const item = document.createElement('div');
      item.className = 'inv-item';
      item.textContent = d;
      container.appendChild(item);
    });
  }

  function tryDoor() {
    if (state.foundDigits.length === 0) {
      alert("The door is locked.");
      return;
    }
    openKeypad();
  }

  function openKeypad() {
    state.currentEntry = '';
    updateDisplay();
    const grid = document.getElementById('digitButtons');
    grid.innerHTML = '';
    
    // Create 0-9 buttons. They all look identical.
    for (let i = 0; i <= 9; i++) {
      const btn = document.createElement('button');
      btn.className = 'digit';
      btn.textContent = i;
      // Only make them clickable if they were found
      if (!state.foundDigits.includes(String(i))) {
        btn.disabled = true;
      } else {
        btn.onclick = () => {
          if (state.currentEntry.length < 3) {
            state.currentEntry += i;
            updateDisplay();
          }
        };
      }
      grid.appendChild(btn);
    }
    document.getElementById('doorModal').style.display = 'flex';
  }

  function updateDisplay() {
    document.getElementById('codeDisplay').textContent = state.currentEntry.padEnd(3, '_').split('').join(' ');
  }

  function clearCode() { state.currentEntry = ''; updateDisplay(); }
  function closeKeypad() { document.getElementById('doorModal').style.display = 'none'; }

  function submitCode() {
    if (state.currentEntry === currentRoomData.code) {
      closeKeypad();
      showScreen('victory');
    } else {
      alert("Wrong code!");
      clearCode();
    }
  }

  renderRooms();
</script>
</body>
</html>
