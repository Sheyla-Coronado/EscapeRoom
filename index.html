<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Escape‚Ä¶ if you can!</title>
  <style>
    /* ========== VARIABLES ========== */
    :root {
      --bg: #1e1e2f;
      --panel: #2a2a40;
      --accent: #c9a227;
      --text: #f5f5f5;
    }

    /* ========== BASE STYLES ========== */
    * {
      box-sizing: border-box;
      font-family: system-ui, sans-serif;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
    }

    .app {
      max-width: 1100px;
      margin: auto;
      padding: 16px;
    }

    h1, h2, h3 {
      margin-bottom: 12px;
    }

    /* ========== SCREEN NAVIGATION ========== */
    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    /* ========== BUTTONS ========== */
    button {
      width: 100%;
      padding: 14px;
      margin: 8px 0;
      border: none;
      border-radius: 8px;
      background: var(--accent);
      color: #000;
      font-size: 1rem;
      cursor: pointer;
      font-weight: 600;
    }

    button.secondary {
      background: #444;
      color: #fff;
    }

    /* ========== FORM INPUTS ========== */
    select, input {
      padding: 6px;
      border-radius: 6px;
      border: none;
    }

    /* ========== CARD GRID ========== */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 12px;
    }

    .card {
      background: var(--panel);
      border-radius: 10px;
      padding: 12px;
    }

    /* ========== ROOMS SCREEN ========== */
    .rooms-topbar {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .rooms-header {
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .rooms-search {
      position: relative;
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
      flex-wrap: nowrap;
    }

    .back-btn {
      width: 28px;
      height: 28px;
      padding: 0;
      border-radius: 6px;
      font-size: 16px;
      background: #444;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      margin-right: 8px;
    }

    .search-input {
      flex: 1;
      max-width: 260px;
      min-width: 0;
      padding: 8px 10px;
      border-radius: 6px;
      border: none;
    }

    .filter-anchor {
      position: relative;
      display: inline-block;
    }

    .filter-btn {
      width: 32px;
      height: 32px;
      border-radius: 6px;
      font-size: 20px;
      background: #444;
      color: #fff;
      padding: 0;
      margin: 0;
    }

    .filter-menu {
      position: absolute;
      top: 50%;
      left: calc(100% + 8px);
      transform: translateY(-50%);
      background: var(--panel);
      padding: 10px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 999;
      min-width: 160px;
    }

    /* ========== GAME SCREEN ========== */
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 8px;
    }

    .game {
      background: var(--panel);
      border-radius: 12px;
      padding: 12px;
    }

    .game-view {
      position: relative;
      width: 100%;
      aspect-ratio: 3 / 2;
      max-height: 66vh;
      border-radius: 10px;
      margin-bottom: 8px;
      background-color: #111;
      display: block;
      padding: 0;
      overflow: hidden;
    }

    .game-view img#sceneImage {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      object-position: center 30%;
      border-radius: 8px;
      z-index: 1;
    }

    /* ========== HOTSPOTS (ROOM CLUES) ========== */
    .hotspot {
      position: absolute;
      background: transparent;
      border: none;
      cursor: pointer;
      z-index: 50;
      pointer-events: auto;
      outline: none;
    }

    /* Positions (Restored from your code) */
    .room-mystery .hotspot.painting { left: 44.1667%; top: 6%; width: 13%; height: 25%; }
    .room-mystery .hotspot.fireplace { left: 40%; top: 33.75%; width: 20%; height: 27.5%; }
    .room-mystery .hotspot.door { left: 73%; top: 25%; width: 10%; height: 35%; z-index: 60; }
    .room-mystery .hotspot.safe { left: 73%; top: 70%; width: 5%; height: 10%; z-index: 60; }
    .room-mystery .hotspot.rug { left: 36.6667%; top: 70%; width: 26.6667%; height: 15%; }
    .room-mystery .hotspot.books { left: 20%; top: 53%; width: 6.6667%; height: 15%; }

    .room-library .hotspot.crystal { left: 40%; top: 35%; width: 6%; height: 5%; }
    .room-library .hotspot.door { left: 63%; top: 8%; width: 18%; height: 45%; z-index: 60; }

    .room-pirate .hotspot.map { left: 4%; top: 48%; width: 8%; height: 10%; }
    .room-pirate .hotspot.door { left: 63%; top: 68%; width: 8%; height: 8%; z-index: 60; }

    .room-asylum .hotspot.bed { left: 54%; top: 30%; width: 14%; height: 32%; transform: rotate(35deg); }
    .room-asylum .hotspot.tv { left: 35%; top: 59%; width: 12%; height: 18%; }
    .room-asylum .hotspot.door { left: 83%; top: 8%; width: 15%; height: 50%; z-index: 60; }

    /* ========== INVENTORY ========== */
    .inventory { display: flex; align-items: center; gap: 12px; padding: 8px; background: rgba(0, 0, 0, 0.14); border-radius: 8px; margin-top: 8px; }
    .inv-label { font-size: 0.85rem; color: #ddd; margin-right: 8px; }
    .inv-items { display: flex; gap: 8px; flex-wrap: wrap; }
    .inv-item { width: 36px; height: 36px; border-radius: 6px; background: #fff; color: #111; display: flex; align-items: center; justify-content: center; font-size: 18px; cursor: pointer; }
    .clue-badge { width: 48px; height: 48px; border-radius: 8px; background: #fef6e3; color: #111; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 700; border: 1px solid rgba(201, 162, 39, 0.25); }

    /* ========== DOOR KEYPAD (FIXED: UNIFORM DESIGN) ========== */
    #codeDisplay {
      font-family: monospace; text-align: center; padding: 8px 10px; background: #fff; color: #111;
      border-radius: 8px; display: inline-block; min-width: 124px; font-weight: 700; margin: 8px 0; letter-spacing: 14px; font-size: 26px;
    }

    #digitButtons { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; max-width: 220px; margin: 6px auto 12px; }

    #digitButtons .digit {
      width: 60px; height: 60px; border-radius: 8px; 
      background: #fff !important; /* Force white background */
      color: #111 !important;      /* Force black text */
      border: 1px solid #ddd; font-size: 20px; cursor: pointer;
      display: inline-flex; align-items: center; justify-content: center;
      outline: none !important;    /* Remove blue focus border */
      box-shadow: none !important;
      -webkit-tap-highlight-color: transparent;
    }

    /* Ensure no visual change when clicking or focusing */
    #digitButtons .digit:active, #digitButtons .digit:focus {
      background: #fff !important;
      color: #111 !important;
    }

    /* Remove the "ghostly" look of disabled buttons */
    #digitButtons .digit:disabled {
      opacity: 1 !important; 
      cursor: default;
    }

    /* ========== MODALS ========== */
    .modal { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.6); display: none; align-items: center; justify-content: center; z-index: 1500; }
    .modal-content { background: var(--panel); padding: 16px; border-radius: 10px; max-width: 320px; text-align: center; }
    .hidden { display: none !important; }
  </style>
</head>
<body>
<div class="app">

  <section id="main" class="screen active">
    <h1 id="mainTitle">üîë Escape‚Ä¶ if you can!</h1>
    <button onclick="resumeGame()" id="btnCurrentRoom">‚ñ∂ Current Room</button>
    <button onclick="showScreen('rooms')" id="btnBrowseRooms">üåê Browse Rooms</button>
    <button onclick="showScreen('settings')" id="btnSettings">‚öô Settings</button>
  </section>

  <section id="rooms" class="screen">
    <div class="topbar rooms-topbar">
      <div class="rooms-header"><h2 id="roomsTitle">Escape Rooms</h2></div>
      <div class="rooms-search">
        <button class="back-btn" onclick="showScreen('main')">‚Üê</button>
        <input id="search" class="search-input" placeholder="Search rooms" oninput="renderRooms()" />
      </div>
    </div>
    <div id="roomGrid" class="grid" style="margin-top:12px"></div>
  </section>

  <section id="game" class="screen">
    <div class="topbar">
      <button class="secondary" onclick="pauseGame()" style="width:44px;height:44px;padding:0;font-size:20px;margin:0;">‚ò∞</button>
      <strong id="roomTitle">Mystery Mansion</strong>
      <span id="timer">05:00</span>
    </div>

    <div class="game">
      <div class="game-view" id="gameView">
        <img id="sceneImage" src="images/foyer.jpg" alt="Room" />

        <div id="hotspotsMystery" class="hotspots-container">
          <button class="hotspot books" title="Inspect books" onclick="interact('spot1')"></button>
          <button class="hotspot painting" title="Inspect painting" onclick="interact('spot2')"></button>
          <button class="hotspot fireplace" title="Inspect fireplace" onclick="interact('spot3')"></button>
          <button class="hotspot rug" title="Lift rug" onclick="interact('spot4')"></button>
          <button class="hotspot safe" title="Inspect safe" onclick="interact('spot5')"></button>
          <button class="hotspot door" title="Try door" onclick="tryDoor()"></button>
        </div>

        <div id="hotspotsLibrary" class="hotspots-container hidden">
          <button class="hotspot crystal" title="Inspect crystal ball" onclick="interact('spot1')"></button>
          <button class="hotspot door" title="Push bookshelf" onclick="tryDoor()"></button>
        </div>

        <div id="hotspotsPirate" class="hotspots-container hidden">
          <button class="hotspot map" title="Search papers" onclick="interact('spot1')"></button>
          <button class="hotspot door" title="Dig here" onclick="tryDoor()"></button>
        </div>

        <div id="hotspotsAsylum" class="hotspots-container hidden">
          <button class="hotspot bed" title="Search bed" onclick="interact('spot1')"></button>
          <button class="hotspot tv" title="Examine TV" onclick="interact('spot2')"></button>
          <button class="hotspot door" title="Try door" onclick="tryDoor()"></button>
        </div>
      </div>

      <div class="inventory" id="inventory">
        <div class="inv-label" id="invLabel">Inventory</div>
        <div class="inv-items" id="invItems"></div>
      </div>
    </div>
  </section>

  <section id="victory" class="screen">
    <h1 id="victoryTitle">üéâ You Escaped!</h1>
    <button onclick="showScreen('rooms')" id="btnBackToRooms">Back to Rooms</button>
  </section>

  <section id="settings" class="screen">
    <h2 id="settingsTitle">Settings</h2>
    <button onclick="changeLanguage()">üåê <span id="langStatus">English</span></button>
    <button onclick="showScreen('main')">Close</button>
  </section>
</div>

<div id="doorModal" class="modal">
  <div class="modal-content">
    <h3 id="doorModalTitle">Door Keypad</h3>
    <div id="codeDisplay">_ _ _</div>
    <div id="digitButtons"></div>
    <div style="display:flex;gap:8px;justify-content:center">
      <button onclick="submitDoorCode()" id="btnSubmit">Submit</button>
      <button onclick="clearDoorCode()" id="btnClear">Clear</button>
    </div>
    <button onclick="closeDoorModal()" style="background:none; color:#999; margin-top:10px;">Close</button>
  </div>
</div>

<div id="modal" class="modal">
  <div class="modal-content">
    <p id="modalText"></p>
    <button onclick="closeModal()" id="btnOK">OK</button>
  </div>
</div>

<script>
  let currentLanguage = 'en';
  const translations = {
    en: { mainTitle: 'üîë Escape Room', btnCurrentRoom: '‚ñ∂ Current Room', btnBrowseRooms: 'üåê Browse Rooms', btnSettings: '‚öô Settings', roomsTitle: 'Escape Rooms', btnOK: 'OK', invLabel: 'Inventory', msgNothingElse: 'Nothing else here.', msgNeedNumbers: 'The door is locked. Find clues first.', msgIncorrectCode: 'Incorrect code!' },
    es: { mainTitle: 'üîë Sala de Escape', btnCurrentRoom: '‚ñ∂ Sala Actual', btnBrowseRooms: 'üåê Explorar Salas', btnSettings: '‚öô Configuraci√≥n', roomsTitle: 'Salas de Escape', btnOK: 'OK', invLabel: 'Inventario', msgNothingElse: 'No queda nada m√°s.', msgNeedNumbers: 'Est√° cerrada. Busca pistas.', msgIncorrectCode: '¬°C√≥digo incorrecto!' }
  };

  const roomsData = {
    'Mystery Mansion': { className: 'room-mystery', hotspotsId: 'hotspotsMystery', image: 'images/foyer.jpg', time: 300, code: '042', clues: { spot1:{number:2,mEN:'Found a 2!'}, spot2:{number:0,mEN:'Found a 0!'}, spot4:{number:4,mEN:'Found a 4!'}, spot3:{item:'üß©',mEN:'Found a gear!'}, spot5:{item:'üîê',mEN:'Safe opened!'} } },
    'Magical Library': { className: 'room-library', hotspotsId: 'hotspotsLibrary', image: 'images/library.png', time: 240, code: '123', clues: { spot1:{number:1,mEN:'Found a 1!'} } },
    'Pirate Cove': { className: 'room-pirate', hotspotsId: 'hotspotsPirate', image: 'images/pirate.jpg', time: 360, code: '999', clues: { spot1:{number:9,mEN:'Found a 9!'} } },
    'Haunted Asylum': { className: 'room-asylum', hotspotsId: 'hotspotsAsylum', image: 'images/asylum.jpg', time: 420, code: '138', clues: { spot1:{number:1,mEN:'Found a 1!'}, spot2:{number:3,mEN:'Found a 3!'} } }
  };

  const state = { inventory: [], foundDigits: [], time: 300, interval: null, currentRoom: 'Mystery Mansion', doorEntry: '' };

  function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function renderRooms() {
    const grid = document.getElementById('roomGrid'); grid.innerHTML = '';
    Object.keys(roomsData).forEach(name => {
      const card = document.createElement('div'); card.className = 'card';
      card.innerHTML = `<strong>${name}</strong><br><button onclick="loadRoom('${name}')">Enter</button>`;
      grid.appendChild(card);
    });
  }

  function loadRoom(name) {
    state.currentRoom = name; const data = roomsData[name];
    document.getElementById('sceneImage').src = data.image;
    document.getElementById('gameView').className = 'game-view ' + data.className;
    document.querySelectorAll('.hotspots-container').forEach(c => c.classList.add('hidden'));
    document.getElementById(data.hotspotsId).classList.remove('hidden');
    state.foundDigits = []; state.inventory = []; state.time = data.time;
    updateInventory(); startTimer(); showScreen('game');
  }

  function interact(key) {
    const clue = roomsData[state.currentRoom].clues[key]; if (!clue) return;
    if (clue.number !== undefined && !state.foundDigits.includes(String(clue.number))) state.foundDigits.push(String(clue.number));
    if (clue.item && !state.inventory.includes(clue.item)) state.inventory.push(clue.item);
    showModal(clue.mEN); updateInventory();
  }

  function updateInventory() {
    const inv = document.getElementById('invItems'); inv.innerHTML = '';
    state.inventory.forEach(i => { const d = document.createElement('div'); d.className = 'inv-item'; d.textContent = i; inv.appendChild(d); });
    state.foundDigits.forEach(n => { const d = document.createElement('div'); d.className = 'inv-item clue-badge'; d.textContent = n; inv.appendChild(d); });
  }

  function tryDoor() {
    if (state.foundDigits.length === 0) showModal(translations[currentLanguage].msgNeedNumbers);
    else openDoorModal();
  }

  function openDoorModal() {
    state.doorEntry = ''; updateCodeDisplay();
    const grid = document.getElementById('digitButtons'); grid.innerHTML = '';
    for(let i=0; i<=9; i++) {
      const btn = document.createElement('button'); btn.className = 'digit'; btn.textContent = i;
      // UNIFORMITY: Every button looks exactly the same, but only found ones are clickable.
      if (!state.foundDigits.includes(String(i))) btn.disabled = true;
      else btn.onclick = () => { if(state.doorEntry.length < 3) { state.doorEntry += i; updateCodeDisplay(); }};
      grid.appendChild(btn);
    }
    document.getElementById('doorModal').style.display = 'flex';
  }

  function updateCodeDisplay() { document.getElementById('codeDisplay').textContent = state.doorEntry.padEnd(3, '_').split('').join(' '); }
  function submitDoorCode() {
    if (state.doorEntry === roomsData[state.currentRoom].code) { closeDoorModal(); showScreen('victory'); }
    else { showModal(translations[currentLanguage].msgIncorrectCode); clearDoorCode(); }
  }
  function clearDoorCode() { state.doorEntry = ''; updateCodeDisplay(); }
  function closeDoorModal() { document.getElementById('doorModal').style.display = 'none'; }
  function showModal(t) { document.getElementById('modalText').textContent = t; document.getElementById('modal').style.display = 'flex'; }
  function closeModal() { document.getElementById('modal').style.display = 'none'; }
  function pauseGame() { clearInterval(state.interval); showScreen('main'); }
  function resumeGame() { startTimer(); showScreen('game'); }

  function startTimer() {
    clearInterval(state.interval);
    state.interval = setInterval(() => {
      state.time--; if (state.time <= 0) { clearInterval(state.interval); showScreen('main'); }
      const m = Math.floor(state.time/60), s = state.time%60;
      document.getElementById('timer').textContent = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    }, 1000);
  }

  function changeLanguage() { currentLanguage = currentLanguage === 'en' ? 'es' : 'en'; document.getElementById('langStatus').textContent = currentLanguage === 'en' ? 'English' : 'Espa√±ol'; }

  renderRooms();
</script>
</body>
</html>
