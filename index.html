<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Escapeâ€¦ if you can!</title>
  <style>
    /* ========== VARIABLES & BASE ========== */
    :root { --bg: #1e1e2f; --panel: #2a2a40; --accent: #c9a227; --text: #f5f5f5; }
    * { box-sizing: border-box; font-family: system-ui, sans-serif; }
    body { margin: 0; background: var(--bg); color: var(--text); overflow-x: hidden; }
    .app { max-width: 1100px; margin: auto; padding: 16px; }

    /* ========== BUTTONS (FIXED: NO HIGHLIGHTS) ========== */
    button { width: 100%; padding: 14px; margin: 8px 0; border: none; border-radius: 8px; background: var(--accent); color: #000; font-size: 1rem; cursor: pointer; font-weight: 600; }
    button.secondary { background: #444; color: #fff; }

    .digit {
      padding: 15px; font-size: 1.2rem; border-radius: 5px; cursor: pointer;
      border: 1px solid #555; background: #fff !important; color: #000 !important;
      outline: none !important; box-shadow: none !important;
    }
    /* This makes sure that even when a button is "found" or "clicked", it doesn't change color */
    .digit:focus, .digit:active, .digit:hover {
      background: #fff !important; color: #000 !important; outline: none !important;
    }
    .digit:disabled { opacity: 1; cursor: default; }

    /* ========== SCREENS ========== */
    .screen { display: none; }
    .screen.active { display: block; }

    /* ========== GAME VIEW & HOTSPOTS ========== */
    .game-view { position: relative; width: 100%; aspect-ratio: 3 / 2; background: #111; border-radius: 12px; overflow: hidden; }
    .game-view img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: contain; z-index: 1; }
    
    .hotspot {
      position: absolute; background: transparent !important; border: none !important;
      cursor: pointer; z-index: 50; outline: none !important;
    }

    /* Hotspot Positions (Mystery Mansion) */
    .room-mystery .hotspot.painting { left: 44%; top: 6%; width: 13%; height: 25%; }
    .room-mystery .hotspot.fireplace { left: 40%; top: 33%; width: 20%; height: 27%; }
    .room-mystery .hotspot.door { left: 73%; top: 25%; width: 10%; height: 35%; }
    .room-mystery .hotspot.safe { left: 73%; top: 70%; width: 5%; height: 10%; }
    .room-mystery .hotspot.rug { left: 36%; top: 70%; width: 26%; height: 15%; }
    .room-mystery .hotspot.books { left: 20%; top: 53%; width: 6%; height: 15%; }

    /* Hotspot Positions (Library) */
    .room-library .hotspot.crystal { left: 40%; top: 35%; width: 6%; height: 5%; }
    .room-library .hotspot.door { left: 63%; top: 8%; width: 18%; height: 45%; }

    /* Hotspot Positions (Pirate) */
    .room-pirate .hotspot.map { left: 4%; top: 48%; width: 8%; height: 10%; }
    .room-pirate .hotspot.door { left: 63%; top: 68%; width: 8%; height: 8%; }

    /* Hotspot Positions (Asylum) */
    .room-asylum .hotspot.tv { left: 35%; top: 59%; width: 12%; height: 18%; }
    .room-asylum .hotspot.door { left: 83%; top: 8%; width: 15%; height: 50%; }

    /* ========== UI ELEMENTS ========== */
    .inventory { display: flex; gap: 10px; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px; margin-top: 10px; min-height: 50px; }
    .inv-item { width: 40px; height: 40px; background: #fff; color: #000; display: flex; align-items: center; justify-content: center; border-radius: 5px; font-weight: bold; }
    #codeDisplay { font-family: monospace; font-size: 30px; letter-spacing: 10px; background: #000; color: var(--accent); padding: 15px; border-radius: 8px; margin-bottom: 15px; text-align: center; }
    #digitButtons { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; z-index: 2000; }
    .modal-content { background: var(--panel); padding: 25px; border-radius: 15px; text-align: center; width: 320px; }
    .hidden { display: none !important; }
  </style>
</head>
<body>

<div class="app">
  <section id="main" class="screen active">
    <h1 id="mainTitle">ðŸ”‘ Escape Room</h1>
    <button onclick="resumeGame()">Resume Game</button>
    <button onclick="showScreen('rooms')">Browse Rooms</button>
    <div style="margin-top: 20px;">
        <select id="langSelect" onchange="changeLanguage(this.value)">
            <option value="en">English</option>
            <option value="es">EspaÃ±ol</option>
        </select>
    </div>
  </section>

  <section id="rooms" class="screen">
    <h2>Select a Room</h2>
    <div id="roomGrid" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;"></div>
    <button class="secondary" onclick="showScreen('main')">Back</button>
  </section>

  <section id="game" class="screen">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
        <button onclick="showScreen('main')" style="width:80px; margin:0;">Menu</button>
        <strong id="roomTitleDisplay">Room</strong>
        <span id="timer">05:00</span>
    </div>

    <div class="game-view" id="gameView">
      <img id="sceneImage" src="" />
      
      <div id="hotspotsMystery" class="hotspots-container">
        <button class="hotspot books" title="Inspect books" onclick="interact('spot1')"></button>
        <button class="hotspot painting" title="Inspect painting" onclick="interact('spot2')"></button>
        <button class="hotspot rug" title="Lift rug" onclick="interact('spot4')"></button>
        <button class="hotspot door" title="Try door" onclick="tryDoor()"></button>
      </div>

      <div id="hotspotsLibrary" class="hotspots-container hidden">
        <button class="hotspot crystal" title="Examine Crystal Ball" onclick="interact('spot1')"></button>
        <button class="hotspot door" title="Push Bookshelf" onclick="tryDoor()"></button>
      </div>

      <div id="hotspotsPirate" class="hotspots-container hidden">
        <button class="hotspot map" title="Look at Map" onclick="interact('spot1')"></button>
        <button class="hotspot door" title="Dig here" onclick="tryDoor()"></button>
      </div>

      <div id="hotspotsAsylum" class="hotspots-container hidden">
        <button class="hotspot tv" title="Examine TV" onclick="interact('spot1')"></button>
        <button class="hotspot door" title="Exit Door" onclick="tryDoor()"></button>
      </div>
    </div>

    <div class="inventory" id="invItems"></div>
  </section>

  <section id="victory" class="screen">
    <h1>ðŸŽ‰ ESCAPED!</h1>
    <button onclick="location.reload()">Play Again</button>
  </section>
</div>

<div id="doorModal" class="modal">
  <div class="modal-content">
    <h3>Enter Code</h3>
    <div id="codeDisplay">_ _ _</div>
    <div id="digitButtons"></div>
    <div style="display:flex; gap:10px; margin-top:15px;">
        <button onclick="submitCode()" style="background:green; color:white;">Check</button>
        <button onclick="state.currentEntry=''; updateKeypadDisplay();" style="background:red; color:white;">Clear</button>
    </div>
    <button onclick="document.getElementById('doorModal').style.display='none'" style="background:none; color:gray;">Close</button>
  </div>
</div>

<script>
  const state = { foundDigits: [], currentEntry: '', time: 300, interval: null };
  let currentRoom = null;

  const roomsData = {
    'Mystery Mansion': { id: 'hotspotsMystery', code: '042', clues: { spot1:{n:'2',m:'Found a 2!'}, spot2:{n:'0',m:'Found a 0!'}, spot4:{n:'4',m:'Found a 4!'} } },
    'Magical Library': { id: 'hotspotsLibrary', code: '123', clues: { spot1:{n:'1',m:'Found a 1!'} } },
    'Pirate Cove': { id: 'hotspotsPirate', code: '999', clues: { spot1:{n:'9',m:'Found a 9!'} } },
    'Haunted Asylum': { id: 'hotspotsAsylum', code: '666', clues: { spot1:{n:'6',m:'Found a 6!'} } }
  };

  function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function renderRooms() {
    const grid = document.getElementById('roomGrid');
    Object.keys(roomsData).forEach(name => {
      const btn = document.createElement('button');
      btn.textContent = name;
      btn.onclick = () => loadRoom(name);
      grid.appendChild(btn);
    });
  }

  function loadRoom(name) {
    currentRoom = roomsData[name];
    document.getElementById('roomTitleDisplay').textContent = name;
    document.querySelectorAll('.hotspots-container').forEach(c => c.classList.add('hidden'));
    document.getElementById(currentRoom.id).classList.remove('hidden');
    document.getElementById('gameView').className = 'game-view ' + 
        (name === 'Mystery Mansion' ? 'room-mystery' : name === 'Magical Library' ? 'room-library' : name === 'Pirate Cove' ? 'room-pirate' : 'room-asylum');
    state.foundDigits = [];
    updateInventory();
    showScreen('game');
  }

  function interact(key) {
    const clue = currentRoom.clues[key];
    if (clue && !state.foundDigits.includes(clue.n)) {
      state.foundDigits.push(clue.n);
      alert(clue.m);
      updateInventory();
    }
  }

  function updateInventory() {
    const inv = document.getElementById('invItems');
    inv.innerHTML = '';
    state.foundDigits.forEach(d => {
      const div = document.createElement('div'); div.className = 'inv-item'; div.textContent = d;
      inv.appendChild(div);
    });
  }

  function tryDoor() {
    if (state.foundDigits.length === 0) { alert("It's locked. Find clues first."); return; }
    state.currentEntry = '';
    updateKeypadDisplay();
    const grid = document.getElementById('digitButtons');
    grid.innerHTML = '';
    for(let i=0; i<=9; i++) {
        const btn = document.createElement('button');
        btn.className = 'digit';
        btn.textContent = i;
        if (!state.foundDigits.includes(String(i))) btn.disabled = true;
        btn.onclick = () => { if(state.currentEntry.length < 3) { state.currentEntry += i; updateKeypadDisplay(); } };
        grid.appendChild(btn);
    }
    document.getElementById('doorModal').style.display = 'flex';
  }

  function updateKeypadDisplay() {
    document.getElementById('codeDisplay').textContent = state.currentEntry.padEnd(3, '_').split('').join(' ');
  }

  function submitCode() {
    if (state.currentEntry === currentRoom.code) showScreen('victory');
    else alert("Wrong code!");
  }

  function resumeGame() { if (currentRoom) showScreen('game'); else showScreen('rooms'); }

  renderRooms();
</script>
</body>
</html>
